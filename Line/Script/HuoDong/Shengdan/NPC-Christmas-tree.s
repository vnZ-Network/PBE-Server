	//****************************************
	//
	//		Copyright:PERFECT WORLD
	//		Modified:2009/12/16
	//		Author:???
	//		TaskName:NPC-Christmas-tree.s
	//		TaskID:??? 2084
	//
	//****************************************
	
	function OnRequest(){
	
		ChangeNpcMode( -1 , 111 , 2084 , ..\Data\Character\Npc\huodong\Christmastree02\Christmastree02.m4f , "a" )

	}
	
	function OnOption0(){
	
		$week = GetSystemTime( "week" )
		$day = GetSystemTime( "mday" )
		$hour = GetSystemTime( "hour" )
		$minute =  GetSystemTime( "minute")
		$month =  GetSystemTime( "month")
		$line = GetServerLineID()
		
	
		if $month != 1
			if $month != 12
				return
			endif
		endif
		if $month == 1
			if $day != 1
				if $day != 2
					if $day != 3
						if $day != 4
							BC( "dialogbox", "player", -1, "n/aThe new year event has not started. ???????\n2009?12?31??2010?1?4??\n??8?30???,????????????????????????,9?30??????????????????????,??????????????" )
							return
						endif
					endif
				endif
			endif
		endif
		if $month == 12
			if $day != 31
				BC( "dialogbox", "player", -1, "n/aThe new year event has not started. ???????\n2009?12?31??2010?1?4??\n??8?30???,????????????????????????,9?30??????????????????????,??????????????" )
				return
			endif
		endif	
			
		if $hour < 20
			BC( "dialogbox", "player", -1, "n/aThe new year event has not started. ???????\n2009?12?31??2010?1?4??\n??8?30???,????????????????????????,9?30??????????????????????,??????????????" )
			return
		endif
		if $hour == 20
			if $minute < 30
				BC( "dialogbox", "player", -1,"n/aThe new year event has not started. ???????\n2009?12?31??2010?1?4??\n??8?30???,????????????????????????,9?30??????????????????????,??????????????" )
				return
			endif
		endif
		if $hour > 21
			BC( "dialogbox", "player", -1, "n/aThe new year event has not started. ???????\n2009?12?31??2010?1?4??\n??8?30???,????????????????????????,9?30??????????????????????,??????????????" )
			return
		endif
		
		$bag_count = GetPlayerInfo( -1 , "nullitem", 0 )
		if $bag_count < 1
			BC( "dialogbox", "player", -1, "You have not enough space in your bag,please fix your bag." )
			return
		endif
		
		$time = GetPlayerVar( -1 , 3916 )
		$nowtime = GetSystemTime( "yday" )
		$nowtime = $nowtime + 1
		$lv = GetPlayerInfo( -1 , "level" )
//----------lv*lv*10-------------
		$a = $lv * $lv
		$b = 10 * $a
		$exp1 = $b 
	
//----------(4*lv-76)*lv*lv/5-----
		$a = $lv * $lv
		$b = 4 * $lv
		$c = $b - 76
		$d = $c * $a
		$e = $d / 5
		$exp2 = $e
//---------------------------------
		if $time == $nowtime
			BC( "dialogbox", "player", -1, "n/a???????????????????????!" )
			return
		else
			AddPlayerInfo( -1 , "item", 50042 , 3 )
			AddStatus( -1 , 10723, 1 )
			SetPlayerVar( -1 , 3916 , $nowtime )
			if $lv < 45
				AddPlayerInfo( -1 , "exp" , $exp1 )
			else
				AddPlayerInfo( -1 , "exp" , $exp2 )
			endif
			$n = RandomNumber ( 0 , 100 )
			if $n < 10
				PlayEffect( -1 , "common\Yanhua\tx_ptyanhua\tx_hhyanhua_02.ini" , 1 )
			endif
			BC( "dialogbox", "player", -1, "n/a??????????????????,9?30??????????????????????????,???????????????" )
		endif
		
	}
	
	function OnOption1(){
		
		$week = GetSystemTime( "week" )
		$day = GetSystemTime( "mday" )
		$hour = GetSystemTime( "hour" )
		$minute =  GetSystemTime( "minute")
		$month =  GetSystemTime( "month")
		$line = GetServerLineID()
		
		if $month != 1
			if $month != 12
				return
			endif
		endif
		if $month == 1
			if $day != 1
				if $day != 2
					if $day != 3
						if $day != 4
							BC( "dialogbox", "player", -1, "n/aThe new year event has not started. ???????\n2009?12?31??2010?1?4??\n??8?30???,????????????????????????,9?30??????????????????????,??????????????" )
							return
						endif
					endif
				endif
			endif
		endif
		if $month == 12
			if $day != 31
				BC( "dialogbox", "player", -1, "n/aThe new year event has not started. ???????\n2009?12?31??2010?1?4??\n??8?30???,????????????????????????,9?30??????????????????????,??????????????" )
				return
			endif
		endif	
			
		if $hour < 20
			BC( "dialogbox", "player", -1, "n/aThe new year event has not started. ???????\n2009?12?31??2010?1?4??\n??8?30???,????????????????????????,9?30??????????????????????,??????????????" )
			return
		endif
		if $hour == 20
			if $minute < 30
				BC( "dialogbox", "player", -1,"n/aThe new year event has not started. ???????\n2009?12?31??2010?1?4??\n??8?30???,????????????????????????,9?30??????????????????????,??????????????" )
				return
			endif
		endif
		if $hour > 21
			BC( "dialogbox", "player", -1, "n/aThe new year event has not started. ???????\n2009?12?31??2010?1?4??\n??8?30???,????????????????????????,9?30??????????????????????,??????????????" )
			return
		endif
		
		$bag_count = GetPlayerInfo( -1 , "nullitem", 0 )
		if $bag_count < 1
			BC( "dialogbox", "player", -1, "You have not enough space in your bag,please fix your bag." )
			return
		endif
		
		$info = IsExistStatus( -1 , 10723 )
		$buff = GetPlayerVar(-1 , 3916 )
		$var = GetPlayerVar(-1 , 3921 )
		$day = GetSystemTime( "yday" )
		$day = $day + 1

		if $day == $var
			BC( "dialogbox", "player", -1, "You already got an [EXP Orb] today." )
			return
		endif
		if $day != $buff
			BC( "dialogbox", "player", -1, "You haven't got a [Festival Blessing] today, you can not get an [EXP Orb] yet." )
			return
		endif
		if $info == 0
			BC( "dialogbox", "player", -1, "Your [Festival Blessing] buff is still active. You can get a [EXP Orb] after this buff has been active for 30 minutes." )
			return
		endif
		
		$bag_count = GetPlayerInfo( -1 , "nullitem", 0 )
		if $bag_count < 1
			BC( "dialogbox", "player", -1, "You have not enough space in your bag,please fix your bag." )
			return
		endif
		
		AddPlayerInfo( -1 , "item" , 50043 , 1  )
		SetPlayerVar(-1 , 3921 , $day )
		
	}